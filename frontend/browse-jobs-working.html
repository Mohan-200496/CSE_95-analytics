<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Browse Jobs - Punjab Rozgar Portal</title>
    
    <script src="../../config/environment.js"></script>
    <script src="../../js/auth.js"></script>
    <script src="../../js/punjab-jobs.js"></script>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Inter', sans-serif; background: #f5f5f5; color: #333; line-height: 1.6; }
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        .header { background: #2563eb; color: white; padding: 20px 0; margin-bottom: 30px; }
        .header h1 { text-align: center; margin: 0; }
        .filters { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); margin-bottom: 30px; }
        .filter-row { display: flex; gap: 15px; flex-wrap: wrap; align-items: center; }
        .filter-group { flex: 1; min-width: 200px; }
        .filter-group label { display: block; margin-bottom: 5px; font-weight: 500; }
        .filter-group select, .filter-group input { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px; }
        .btn { padding: 10px 20px; background: #2563eb; color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: 500; }
        .btn:hover { background: #1d4ed8; }
        .jobs-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(350px, 1fr)); gap: 20px; }
        .job-card { background: white; border-radius: 12px; padding: 24px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); transition: transform 0.2s; }
        .job-card:hover { transform: translateY(-5px); }
        .job-title { font-size: 1.25rem; font-weight: 600; color: #1f2937; margin-bottom: 8px; }
        .company-name { color: #6b7280; font-size: 0.9rem; margin-bottom: 12px; }
        .job-description { color: #4b5563; font-size: 0.9rem; line-height: 1.5; margin-bottom: 16px; }
        .job-meta { display: flex; justify-content: between; align-items: center; margin-bottom: 16px; flex-wrap: wrap; gap: 10px; }
        .location, .salary, .job-type { font-size: 0.85rem; color: #6b7280; display: flex; align-items: center; gap: 4px; }
        .skills { margin-bottom: 16px; }
        .skill-tag { display: inline-block; background: #e5e7eb; color: #374151; padding: 4px 8px; border-radius: 12px; font-size: 0.75rem; margin: 2px; }
        .job-actions { display: flex; gap: 10px; }
        .btn-apply { background: #10b981; color: white; padding: 8px 16px; border: none; border-radius: 6px; cursor: pointer; font-size: 0.9rem; }
        .btn-save { background: #6b7280; color: white; padding: 8px 16px; border: none; border-radius: 6px; cursor: pointer; font-size: 0.9rem; }
        .btn-apply:hover { background: #059669; }
        .btn-save:hover { background: #4b5563; }
        .stats { background: white; padding: 20px; border-radius: 8px; margin-bottom: 20px; text-align: center; }
        .remote-badge { background: #10b981; color: white; padding: 2px 8px; border-radius: 12px; font-size: 0.75rem; }
        .no-jobs { text-align: center; padding: 40px; color: #6b7280; }
    </style>
</head>
<body>
    <div class="header">
        <div class="container">
            <h1><i class="fas fa-briefcase"></i> Browse Jobs in Punjab</h1>
        </div>
    </div>

    <div class="container">
        <div class="stats">
            <div id="job-stats">Loading job statistics...</div>
        </div>

        <div class="filters">
            <div class="filter-row">
                <div class="filter-group">
                    <label for="search">Search Jobs</label>
                    <input type="text" id="search" placeholder="Job title, company, or keywords...">
                </div>
                <div class="filter-group">
                    <label for="category">Category</label>
                    <select id="category">
                        <option value="">All Categories</option>
                        <option value="Technology">Technology</option>
                        <option value="Marketing">Marketing</option>
                        <option value="Government">Government</option>
                        <option value="Customer Service">Customer Service</option>
                        <option value="Design">Design</option>
                        <option value="Human Resources">Human Resources</option>
                        <option value="Sales">Sales</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label for="location">Location</label>
                    <select id="location">
                        <option value="">All Locations</option>
                        <option value="Chandigarh">Chandigarh</option>
                        <option value="Ludhiana">Ludhiana</option>
                        <option value="Amritsar">Amritsar</option>
                        <option value="Jalandhar">Jalandhar</option>
                        <option value="Patiala">Patiala</option>
                        <option value="Mohali">Mohali</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label for="remote">Work Type</label>
                    <select id="remote">
                        <option value="">All Types</option>
                        <option value="true">Remote Available</option>
                        <option value="false">Office Only</option>
                    </select>
                </div>
                <div class="filter-group">
                    <button class="btn" onclick="applyFilters()">
                        <i class="fas fa-search"></i> Search
                    </button>
                </div>
            </div>
        </div>

        <div id="jobs-container">
            <div class="jobs-grid" id="jobs-grid"></div>
        </div>
    </div>

    <script>
        let allJobs = [];

        function displayJobs(jobs) {
            const jobsGrid = document.getElementById('jobs-grid');
            
            if (jobs.length === 0) {
                jobsGrid.innerHTML = '<div class="no-jobs"><i class="fas fa-search"></i><br>No jobs found matching your criteria</div>';
                return;
            }

            jobsGrid.innerHTML = jobs.map(job => `
                <div class="job-card">
                    <div class="job-title">${job.title}</div>
                    <div class="company-name">
                        <i class="fas fa-building"></i> ${job.company_name}
                    </div>
                    <div class="job-description">${job.description}</div>
                    
                    <div class="job-meta">
                        <div class="location">
                            <i class="fas fa-map-marker-alt"></i>
                            ${job.location.city}, ${job.location.state}
                        </div>
                        ${job.remote_allowed ? '<span class="remote-badge">Remote OK</span>' : ''}
                    </div>
                    
                    <div class="job-meta">
                        <div class="salary">
                            <i class="fas fa-rupee-sign"></i>
                            â‚¹${job.salary.min.toLocaleString()} - â‚¹${job.salary.max.toLocaleString()}/month
                        </div>
                        <div class="job-type">
                            <i class="fas fa-clock"></i>
                            ${job.job_type.replace('_', ' ').toUpperCase()}
                        </div>
                    </div>

                    <div class="skills">
                        ${job.skills_required.map(skill => 
                            `<span class="skill-tag">${skill}</span>`
                        ).join('')}
                    </div>

                    <div class="job-actions">
                        <button class="btn-apply" onclick="applyToJob('${job.job_id}', '${job.title}')">
                            <i class="fas fa-paper-plane"></i> Apply Now
                        </button>
                        <button class="btn-save" onclick="saveJob('${job.job_id}', '${job.title}')">
                            <i class="fas fa-heart"></i> Save
                        </button>
                    </div>
                </div>
            `).join('');
        }

        function updateStats(jobs) {
            const totalJobs = jobs.length;
            const remoteJobs = jobs.filter(job => job.remote_allowed).length;
            const categories = [...new Set(jobs.map(job => job.category))].length;
            const avgSalary = Math.round(jobs.reduce((sum, job) => sum + (job.salary.min + job.salary.max) / 2, 0) / totalJobs);

            document.getElementById('job-stats').innerHTML = `
                <div style="display: flex; justify-content: space-around; flex-wrap: wrap; gap: 20px;">
                    <div><strong>${totalJobs}</strong><br><small>Total Jobs</small></div>
                    <div><strong>${remoteJobs}</strong><br><small>Remote Available</small></div>
                    <div><strong>${categories}</strong><br><small>Categories</small></div>
                    <div><strong>â‚¹${avgSalary.toLocaleString()}</strong><br><small>Avg Salary</small></div>
                </div>
            `;
        }

        function applyFilters() {
            const filters = {
                search: document.getElementById('search').value,
                category: document.getElementById('category').value,
                location: document.getElementById('location').value,
                remote_allowed: document.getElementById('remote').value ? 
                    document.getElementById('remote').value === 'true' : undefined
            };

            const filteredJobs = getJobs(filters);
            displayJobs(filteredJobs);
            updateStats(filteredJobs);

            console.log('ðŸ“Š Analytics: Jobs Filtered', {
                filters: filters,
                results_count: filteredJobs.length
            });
        }

        function applyToJob(jobId, title) {
            alert(`Application submitted for: ${title}\n\nJob ID: ${jobId}\n\nYou will be redirected to the application form.`);
            console.log('ðŸ“Š Analytics: Job Application Started', { job_id: jobId, job_title: title });
        }

        function saveJob(jobId, title) {
            alert(`Job saved: ${title}`);
            console.log('ðŸ“Š Analytics: Job Saved', { job_id: jobId, job_title: title });
        }

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            allJobs = punjabJobs;
            displayJobs(allJobs);
            updateStats(allJobs);
            
            console.log('ðŸ“Š Analytics: Job Browse Page Loaded', {
                total_jobs: allJobs.length,
                page_type: 'job_browse'
            });

            // Add event listeners for real-time filtering
            document.getElementById('search').addEventListener('input', applyFilters);
            document.getElementById('category').addEventListener('change', applyFilters);
            document.getElementById('location').addEventListener('change', applyFilters);
            document.getElementById('remote').addEventListener('change', applyFilters);
        });
    </script>
</body>
</html>