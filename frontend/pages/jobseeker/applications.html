<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Applications - Punjab Rozgar Portal</title>
    
    <!-- Punjab Rozgar Authentication -->
    <script src="../../js/auth.js" onerror="console.log('Auth.js failed to load')"></script>
    <!-- Punjab Rozgar Analytics -->
    <script src="../../js/punjab-analytics.js" onerror="console.log('Analytics.js failed to load')"></script>
    
    <!-- Fallback analytics if main fails -->
    <script>
        if (typeof PunjabRozgarAnalytics === 'undefined') {
            console.log('Creating fallback analytics');
            window.trackEvent = function(name, props) { console.log('Track:', name, props); };
            window.punjabAnalytics = { track: window.trackEvent };
        }
    </script>
    
    <!-- Styles -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        /* Monochromatic Theme Variables */
        :root {
            --primary-black: #000000;
            --secondary-black: #1a1a1a;
            --dark-gray: #2d2d2d;
            --medium-gray: #4a4a4a;
            --light-gray: #6b6b6b;
            --lighter-gray: #8a8a8a;
            --very-light-gray: #d1d1d1;
            --off-white: #f5f5f5;
            --pure-white: #ffffff;
            --accent-gray: #404040;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, var(--off-white) 0%, var(--very-light-gray) 100%);
            color: var(--secondary-black);
        }

        .header {
            background: linear-gradient(135deg, var(--primary-black) 0%, var(--secondary-black) 100%);
            color: white;
            padding: 1.5rem 0;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        .header .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header .logo {
            font-size: 1.8rem;
            font-weight: 700;
            text-decoration: none;
            color: white;
        }

        .header .nav-links {
            display: flex;
            gap: 2rem;
            list-style: none;
        }

        .header .nav-links a {
            color: white;
            text-decoration: none;
            transition: opacity 0.3s ease;
        }

        .header .nav-links a:hover {
            opacity: 0.8;
        }

        .main-container {
            max-width: 1200px;
            margin: 2rem auto;
            padding: 0 2rem;
        }

        .page-header {
            background: rgba(255, 255, 255, 0.95);
            padding: 2rem;
            border-radius: 12px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            border: 1px solid var(--very-light-gray);
            margin-bottom: 2rem;
        }

        .page-header h1 {
            font-size: 2.5rem;
            margin-bottom: 1rem;
            color: var(--primary-black);
        }

        .page-header p {
            color: var(--light-gray);
            font-size: 1.1rem;
        }

        .stats-overview {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.95);
            padding: 1.5rem;
            border-radius: 12px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            border: 1px solid var(--very-light-gray);
            text-align: center;
        }

        .stat-card .stat-icon {
            font-size: 2rem;
            margin-bottom: 1rem;
        }

        .stat-card.total .stat-icon {
            color: var(--primary-black);
        }

        .stat-card.pending .stat-icon {
            color: var(--dark-gray);
        }

        .stat-card.interview .stat-icon {
            color: var(--medium-gray);
        }

        .stat-card.rejected .stat-icon {
            color: var(--accent-gray);
        }

        .stat-card .stat-number {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            color: var(--secondary-black);
        }

        .stat-card .stat-label {
            color: var(--light-gray);
            font-size: 0.9rem;
        }

        .applications-container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 12px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            border: 1px solid var(--very-light-gray);
            overflow: hidden;
        }

        .applications-header {
            background: var(--off-white);
            padding: 1.5rem;
            border-bottom: 1px solid var(--very-light-gray);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .applications-header h3 {
            font-size: 1.3rem;
            color: var(--secondary-black);
        }

        .filter-tabs {
            display: flex;
            gap: 0.5rem;
        }

        .filter-tab {
            padding: 0.5rem 1rem;
            border: none;
            background: transparent;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: background 0.3s ease;
            color: var(--medium-gray);
        }

        .filter-tab.active {
            background: #667eea;
            color: white;
        }

        .filter-tab:hover:not(.active) {
            background: #e9ecef;
        }

        .applications-list {
            max-height: 600px;
            overflow-y: auto;
        }

        .application-item {
            display: flex;
            align-items: center;
            padding: 1.5rem;
            border-bottom: 1px solid #e1e5e9;
            transition: background 0.3s ease;
        }

        .application-item:hover {
            background: #f8f9fa;
        }

        .application-item:last-child {
            border-bottom: none;
        }

        .application-logo {
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            margin-right: 1rem;
        }

        .application-details {
            flex: 1;
        }

        .application-title {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 0.25rem;
        }

        .application-company {
            color: #667eea;
            font-weight: 500;
            margin-bottom: 0.5rem;
        }

        .application-meta {
            display: flex;
            gap: 1rem;
            font-size: 0.9rem;
            color: #666;
        }

        .application-meta span {
            display: flex;
            align-items: center;
            gap: 0.25rem;
        }

        .application-status {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            gap: 0.5rem;
        }

        .status-badge {
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 500;
        }

        .status-applied {
            background: #fff3cd;
            color: #856404;
        }

        .status-under-review {
            background: #cce5ff;
            color: #004085;
        }

        .status-interview {
            background: #d4edda;
            color: #155724;
        }

        .status-rejected {
            background: #f8d7da;
            color: #721c24;
        }

        .status-hired {
            background: #d1ecf1;
            color: #0c5460;
        }

        .application-actions {
            display: flex;
            gap: 0.5rem;
        }

        .btn {
            padding: 0.25rem 0.75rem;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.8rem;
            text-decoration: none;
            transition: background 0.3s ease;
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        .btn-primary:hover {
            background: #5a6fd8;
        }

        .btn-secondary {
            background: #f8f9fa;
            color: #667eea;
            border: 1px solid #667eea;
        }

        .btn-secondary:hover {
            background: #667eea;
            color: white;
        }

        .btn-danger {
            background: #dc3545;
            color: white;
        }

        .btn-danger:hover {
            background: #c82333;
        }

        .empty-state {
            text-align: center;
            padding: 4rem 2rem;
            color: #666;
        }

        .empty-state i {
            font-size: 4rem;
            color: #ddd;
            margin-bottom: 1rem;
        }

        .empty-state h3 {
            margin-bottom: 1rem;
        }

        .empty-state .btn {
            padding: 0.75rem 1.5rem;
            font-size: 1rem;
        }

        .application-timeline {
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid #e1e5e9;
        }

        .timeline-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 0.5rem;
            font-size: 0.8rem;
            color: #666;
        }

        .timeline-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #667eea;
        }

        @media (max-width: 768px) {
            .header .nav-links {
                display: none;
            }

            .stats-overview {
                grid-template-columns: repeat(2, 1fr);
            }

            .applications-header {
                flex-direction: column;
                gap: 1rem;
                align-items: stretch;
            }

            .filter-tabs {
                justify-content: center;
            }

            .application-item {
                flex-direction: column;
                align-items: stretch;
                gap: 1rem;
                text-align: center;
            }

            .application-logo {
                align-self: center;
                margin: 0;
            }

            .application-status {
                align-items: center;
            }
        }
    </style>
</head>
<body>
    <script>
        // Initialize page authentication
        document.addEventListener('DOMContentLoaded', function () {
            console.log('Applications page loaded, skipping auth check for testing');
        });
    </script>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            if (!authManager.requireRole('job_seeker', '/pages/auth/login.html')) return;
        });
    </script>
    <!-- Header -->
    <header class="header">
        <div class="container">
            <a href="../../index.html" class="logo">Punjab Rozgar</a>
            <nav>
                <ul class="nav-links">
                    <li><a href="../../index.html">Home</a></li>
                    <li><a href="../jobs/browse.html">Jobs</a></li>
                    <li><a href="dashboard.html">Dashboard</a></li>
                    <li><a href="#" onclick="authManager.logout()">Logout</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <div class="main-container">
        <!-- Quick Access for Testing -->
        <div style="background: #fff3cd; padding: 1rem; border-radius: 8px; margin-bottom: 1rem; border-left: 4px solid #ffc107;">
            <strong>Quick Access:</strong> 
            <button onclick="setTestJobSeeker(); location.reload();" 
                    style="background: #ffc107; border: none; padding: 0.25rem 0.5rem; border-radius: 4px; margin-left: 0.5rem;">
                Set JobSeeker Access
            </button>
            <span style="font-size: 0.85rem; color: #856404; margin-left: 1rem;">
                (Testing only - remove in production)
            </span>
        </div>
    
        <!-- Page Header -->
        <div class="page-header">
            <h1>My Applications</h1>
            <p>Track the status of your job applications and manage your career journey</p>
        </div>

        <!-- Stats Overview -->
        <div class="stats-overview">
            <div class="stat-card total">
                <div class="stat-icon">
                    <i class="fas fa-file-alt"></i>
                </div>
                <div class="stat-number" id="totalApplications">12</div>
                <div class="stat-label">Total Applications</div>
            </div>

            <div class="stat-card pending">
                <div class="stat-icon">
                    <i class="fas fa-clock"></i>
                </div>
                <div class="stat-number" id="pendingApplications">5</div>
                <div class="stat-label">Under Review</div>
            </div>

            <div class="stat-card interview">
                <div class="stat-icon">
                    <i class="fas fa-calendar-check"></i>
                </div>
                <div class="stat-number" id="interviewApplications">3</div>
                <div class="stat-label">Interviews</div>
            </div>

            <div class="stat-card rejected">
                <div class="stat-icon">
                    <i class="fas fa-times-circle"></i>
                </div>
                <div class="stat-number" id="rejectedApplications">2</div>
                <div class="stat-label">Rejected</div>
            </div>
        </div>

        <!-- Applications Container -->
        <div class="applications-container">
            <div class="applications-header">
                <h3>Job Applications</h3>
                <div class="filter-tabs">
                    <button class="filter-tab active" onclick="filterApplications('all')">All</button>
                    <button class="filter-tab" onclick="filterApplications('applied')">Applied</button>
                    <button class="filter-tab" onclick="filterApplications('under-review')">Under Review</button>
                    <button class="filter-tab" onclick="filterApplications('interview')">Interview</button>
                    <button class="filter-tab" onclick="filterApplications('rejected')">Rejected</button>
                </div>
            </div>

            <div class="applications-list" id="applicationsList">
                <!-- Applications will be loaded here -->
            </div>
        </div>
    </div>

    <script>
        // Ensure user is logged in and is a job seeker
        if (!authManager.isLoggedIn()) {
            window.location.href = '../auth/login.html';
        }

        const user = authManager.getCurrentUser();
        if (!user || user.role !== 'job_seeker') {
            alert('Access denied. This page is only for job seekers.');
            window.location.href = '../../index.html';
        }

        // Comprehensive Punjab Applications Data
        const applications = [
            {
                id: 1,
                jobTitle: "Senior Full Stack Developer",
                company: "TechCorp Solutions Chandigarh",
                companyLogo: "TC",
                status: "interview",
                appliedDate: "2024-11-25",
                location: "Chandigarh, Punjab",
                salary: "₹8-12 LPA",
                type: "Full-time",
                experience: "3-6 years",
                skills: ["React", "Node.js", "MongoDB", "AWS"],
                interviewDate: "2024-11-28",
                timeline: [
                    { date: "2024-11-25", event: "Application submitted", status: "success" },
                    { date: "2024-11-26", event: "Resume reviewed by HR", status: "success" },
                    { date: "2024-11-27", event: "Technical assessment completed", status: "success" },
                    { date: "2024-11-28", event: "Technical interview scheduled", status: "pending" }
                ],
                notes: "Strong technical background, good portfolio projects"
            },
            {
                id: 2,
                jobTitle: "Deputy Collector (General Administration)",
                company: "Government of Punjab",
                companyLogo: "GP",
                status: "under-review",
                appliedDate: "2024-11-20",
                location: "Ludhiana, Punjab",
                salary: "₹56,100 - ₹1,77,500",
                type: "Government",
                experience: "Fresh Graduate",
                examDate: "2024-12-15",
                timeline: [
                    { date: "2024-11-20", event: "Online application submitted", status: "success" },
                    { date: "2024-11-22", event: "Document verification completed", status: "success" },
                    { date: "2024-11-24", event: "Application under review", status: "pending" },
                    { date: "2024-12-15", event: "Written examination scheduled", status: "upcoming" }
                ],
                notes: "Civil services examination, prepare for general knowledge and current affairs"
            },
            {
                id: 3,
                jobTitle: "React Frontend Developer",
                company: "Digital Innovations Mohali",
                companyLogo: "DI",
                status: "shortlisted",
                appliedDate: "2024-11-18",
                location: "Mohali, Punjab",
                salary: "₹6-8.5 LPA",
                type: "Full-time",
                experience: "2-4 years",
                skills: ["React", "TypeScript", "Redux", "CSS3"],
                timeline: [
                    { date: "2024-11-18", event: "Application submitted", status: "success" },
                    { date: "2024-11-19", event: "Portfolio reviewed", status: "success" },
                    { date: "2024-11-21", event: "Phone screening completed", status: "success" },
                    { date: "2024-11-23", event: "Shortlisted for technical round", status: "success" }
                ],
                notes: "Excellent React skills demonstrated, portfolio impressed hiring team"
            },
            {
                id: 4,
                jobTitle: "Python Backend Developer",
                company: "DataTech Solutions Amritsar",
                companyLogo: "DS",
                status: "applied",
                appliedDate: "2024-11-22",
                location: "Amritsar, Punjab",
                salary: "₹7-9.5 LPA",
                type: "Full-time",
                experience: "2-5 years",
                skills: ["Python", "Django", "PostgreSQL", "Docker"],
                timeline: [
                    { date: "2024-11-22", event: "Application submitted", status: "success" },
                    { date: "2024-11-23", event: "Application received", status: "success" }
                ],
                notes: "Application recently submitted, awaiting initial review"
            },
            {
                id: 5,
                jobTitle: "Assistant Engineer (Civil)",
                company: "Punjab Public Works Department",
                companyLogo: "PW",
                status: "interview",
                appliedDate: "2024-11-15",
                location: "Patiala, Punjab",
                salary: "₹35,400 - ₹1,12,400",
                type: "Government",
                experience: "Fresh Graduate",
                examDate: "2024-12-01",
                timeline: [
                    { date: "2024-11-15", event: "Application submitted", status: "success" },
                    { date: "2024-11-17", event: "Eligibility verified", status: "success" },
                    { date: "2024-11-20", event: "Written exam cleared", status: "success" },
                    { date: "2024-12-01", event: "Interview scheduled", status: "pending" }
                ],
                notes: "Written examination cleared with good marks, prepare for technical interview"
            },
            {
                id: 6,
                jobTitle: "DevOps Engineer",
                company: "CloudOps Technologies Jalandhar",
                companyLogo: "CO",
                status: "offered",
                appliedDate: "2024-11-10",
                location: "Jalandhar, Punjab",
                salary: "₹8.5-13 LPA",
                type: "Full-time",
                experience: "3-6 years",
                skills: ["AWS", "Kubernetes", "Docker", "Jenkins", "Terraform"],
                offerDate: "2024-11-26",
                timeline: [
                    { date: "2024-11-10", event: "Application submitted", status: "success" },
                    { date: "2024-11-12", event: "Technical assessment", status: "success" },
                    { date: "2024-11-15", event: "Technical interview", status: "success" },
                    { date: "2024-11-18", event: "HR round", status: "success" },
                    { date: "2024-11-22", event: "Reference check completed", status: "success" },
                    { date: "2024-11-26", event: "Job offer extended", status: "success" }
                ],
                notes: "Excellent performance in all rounds, offer letter sent with competitive package"
            },
            {
                id: 7,
                jobTitle: "UI/UX Designer",
                company: "Creative Studio Punjab Ludhiana",
                companyLogo: "CS",
                status: "interview",
                appliedDate: "2024-11-16",
                location: "Ludhiana, Punjab",
                salary: "₹4.5-7 LPA",
                type: "Full-time",
                experience: "1-3 years",
                skills: ["Figma", "Adobe XD", "Sketch", "Prototyping", "User Research"],
                interviewDate: "2024-11-30",
                timeline: [
                    { date: "2024-11-16", event: "Application submitted", status: "success" },
                    { date: "2024-11-17", event: "Portfolio reviewed", status: "success" },
                    { date: "2024-11-20", event: "Design challenge assigned", status: "success" },
                    { date: "2024-11-24", event: "Design challenge submitted", status: "success" },
                    { date: "2024-11-30", event: "Final interview scheduled", status: "pending" }
                ],
                notes: "Design challenge well received, final interview with creative director"
            },
            {
                id: 8,
                jobTitle: "Data Analyst",
                company: "Punjab Analytics Hub Patiala",
                companyLogo: "PA",
                status: "under-review",
                appliedDate: "2024-11-14",
                location: "Patiala, Punjab",
                salary: "₹5.5-7.5 LPA",
                type: "Full-time",
                experience: "1-3 years",
                skills: ["Python", "SQL", "Tableau", "Power BI", "Excel"],
                timeline: [
                    { date: "2024-11-14", event: "Application submitted", status: "success" },
                    { date: "2024-11-16", event: "Initial screening", status: "success" },
                    { date: "2024-11-18", event: "SQL test completed", status: "success" },
                    { date: "2024-11-20", event: "Application under final review", status: "pending" }
                ],
                notes: "Strong SQL skills, awaiting feedback on technical assessment"
            },
            {
                id: 9,
                jobTitle: "Mobile App Developer (Flutter)",
                company: "AppCraft Studios Chandigarh",
                companyLogo: "AC",
                status: "rejected",
                appliedDate: "2024-11-08",
                location: "Chandigarh, Punjab",
                salary: "₹6.5-9 LPA",
                type: "Full-time",
                experience: "2-4 years",
                skills: ["Flutter", "Dart", "Firebase", "REST APIs"],
                timeline: [
                    { date: "2024-11-08", event: "Application submitted", status: "success" },
                    { date: "2024-11-10", event: "Technical screening", status: "success" },
                    { date: "2024-11-12", event: "Coding challenge", status: "warning" },
                    { date: "2024-11-15", event: "Application rejected", status: "error" }
                ],
                notes: "Looking for more advanced Flutter experience with state management"
            },
            {
                id: 10,
                jobTitle: "Junior Software Engineer",
                company: "TechStart Punjab Mohali",
                companyLogo: "TP",
                status: "applied",
                appliedDate: "2024-11-24",
                location: "Mohali, Punjab",
                salary: "₹4-6 LPA",
                type: "Full-time",
                experience: "0-2 years",
                skills: ["Java", "Spring Boot", "MySQL", "Git"],
                timeline: [
                    { date: "2024-11-24", event: "Application submitted", status: "success" }
                ],
                notes: "Entry level position, good for gaining industry experience"
            },
            {
                id: 11,
                jobTitle: "Digital Marketing Specialist",
                company: "Punjab Marketing Solutions Ludhiana",
                companyLogo: "PM",
                status: "shortlisted",
                appliedDate: "2024-11-12",
                location: "Ludhiana, Punjab",
                salary: "₹3.5-5.5 LPA",
                type: "Full-time",
                experience: "1-3 years",
                skills: ["Google Ads", "Facebook Marketing", "SEO", "Content Marketing"],
                timeline: [
                    { date: "2024-11-12", event: "Application submitted", status: "success" },
                    { date: "2024-11-14", event: "Portfolio review", status: "success" },
                    { date: "2024-11-17", event: "Marketing campaign case study", status: "success" },
                    { date: "2024-11-21", event: "Shortlisted for final round", status: "success" }
                ],
                notes: "Strong digital marketing portfolio, impressed with ROI improvements"
            },
            {
                id: 12,
                jobTitle: "Quality Assurance Engineer",
                company: "Punjab Software Testing Center Amritsar",
                companyLogo: "PS",
                status: "interview",
                appliedDate: "2024-11-19",
                location: "Amritsar, Punjab",
                salary: "₹4.5-6.5 LPA",
                type: "Full-time",
                experience: "1-3 years",
                skills: ["Selenium", "Manual Testing", "Automation", "JIRA", "TestNG"],
                interviewDate: "2024-11-29",
                timeline: [
                    { date: "2024-11-19", event: "Application submitted", status: "success" },
                    { date: "2024-11-21", event: "QA fundamentals test", status: "success" },
                    { date: "2024-11-24", event: "Automation challenge", status: "success" },
                    { date: "2024-11-29", event: "Technical interview scheduled", status: "pending" }
                ],
                notes: "Good automation skills demonstrated, technical interview with QA lead"
            }
        ];

        let filteredApplications = [...applications];
        let currentFilter = 'all';

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            updateStats();
            renderApplications();
        });

        function updateStats() {
            const stats = {
                total: applications.length,
                pending: applications.filter(app => app.status === 'under-review' || app.status === 'applied').length,
                interview: applications.filter(app => app.status === 'interview' || app.status === 'shortlisted').length,
                rejected: applications.filter(app => app.status === 'rejected').length,
                offered: applications.filter(app => app.status === 'offered').length
            };

            document.getElementById('totalApplications').textContent = stats.total;
            document.getElementById('pendingApplications').textContent = stats.pending;
            document.getElementById('interviewApplications').textContent = stats.interview + stats.offered;
            document.getElementById('rejectedApplications').textContent = stats.rejected;
        }

        function filterApplications(status) {
            currentFilter = status;
            
            // Update active tab
            document.querySelectorAll('.filter-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            event.target.classList.add('active');

            // Filter applications
            if (status === 'all') {
                filteredApplications = [...applications];
            } else {
                filteredApplications = applications.filter(app => app.status === status);
            }

            renderApplications();
        }

        function renderApplications() {
            const container = document.getElementById('applicationsList');

            if (filteredApplications.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-file-alt"></i>
                        <h3>No applications found</h3>
                        <p>You haven't applied for any jobs yet, or there are no applications matching the current filter.</p>
                        <a href="../jobs/browse.html" class="btn btn-primary">Browse Jobs</a>
                    </div>
                `;
                return;
            }

            container.innerHTML = filteredApplications.map(app => `
                <div class="application-item">
                    <div class="application-logo">${app.companyLogo}</div>
                    <div class="application-details">
                        <div class="application-title">${app.jobTitle}</div>
                        <div class="application-company">${app.company}</div>
                        <div class="application-meta">
                            <span><i class="fas fa-calendar"></i> Applied ${formatDate(app.appliedDate)}</span>
                            <span><i class="fas fa-map-marker-alt"></i> ${app.location}</span>
                            <span><i class="fas fa-money-bill-wave"></i> ${app.salary}</span>
                        </div>
                        ${renderTimeline(app.timeline)}
                    </div>
                    <div class="application-status">
                        <span class="status-badge status-${app.status}">${getStatusLabel(app.status)}</span>
                        <div class="application-actions">
                            <button class="btn btn-primary" onclick="viewApplication(${app.id})">View</button>
                            ${app.status === 'applied' || app.status === 'under-review' ? 
                                `<button class="btn btn-danger" onclick="withdrawApplication(${app.id})">Withdraw</button>` : 
                                `<button class="btn btn-secondary" onclick="viewJobDetails(${app.id})">Job Details</button>`
                            }
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function renderTimeline(timeline) {
            const recentEvents = timeline.slice(-2);
            return `
                <div class="application-timeline">
                    ${recentEvents.map(event => `
                        <div class="timeline-item">
                            <div class="timeline-dot"></div>
                            <span>${formatDate(event.date)} - ${event.event}</span>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        function getStatusLabel(status) {
            const labels = {
                'applied': 'Applied',
                'under-review': 'Under Review',
                'interview': 'Interview',
                'rejected': 'Rejected',
                'hired': 'Hired'
            };
            return labels[status] || status;
        }

        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('en-US', { 
                year: 'numeric', 
                month: 'short', 
                day: 'numeric' 
            });
        }

        function viewApplication(appId) {
            const application = applications.find(app => app.id === appId);
            if (application) {
                alert(`Viewing application for ${application.jobTitle} at ${application.company}`);
                // In a real app, this would open a detailed view or modal
            }
        }

        function withdrawApplication(appId) {
            const application = applications.find(app => app.id === appId);
            if (application && confirm(`Are you sure you want to withdraw your application for ${application.jobTitle}?`)) {
                // Remove from applications array
                const index = applications.findIndex(app => app.id === appId);
                applications.splice(index, 1);
                
                // Update filtered applications
                filterApplications(currentFilter);
                updateStats();
                
                alert('Application withdrawn successfully.');
            }
        }

        function viewJobDetails(appId) {
            const application = applications.find(app => app.id === appId);
            if (application) {
                // Redirect to job details page
                window.location.href = `../jobs/details.html?id=${appId}`;
            }
        }

        // Helper functions
        function setTestJobSeeker() {
            if (typeof authManager !== 'undefined' && authManager.setTestAdminUser) {
                const testJobSeeker = {
                    id: 3,
                    user_id: 'jobseeker_test_user',
                    email: 'jobseeker@example.com',
                    name: 'Test Job Seeker',
                    role: 'job_seeker',
                    profile: { 
                        skills: ['JavaScript', 'React', 'Node.js'],
                        experience_years: 3,
                        location: 'Chandigarh, Punjab'
                    }
                };
                authManager.setCurrentUser(testJobSeeker, false);
            } else {
                console.log('Setting test job seeker access');
                localStorage.setItem('testJobSeeker', 'true');
            }
        }

        function logout() {
            if (typeof authManager !== 'undefined' && authManager.logout) {
                authManager.logout();
            } else {
                localStorage.removeItem('testJobSeeker');
                window.location.href = '../../index.html';
            }
        }

        // Initialize page when DOM loads
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(function() {
                if (typeof authManager === 'undefined') {
                    console.log('authManager not found, creating fallback');
                    window.authManager = {
                        isLoggedIn: () => true,
                        isJobSeeker: () => true,
                        getCurrentUser: () => ({ name: 'Test Job Seeker', email: 'jobseeker@example.com' }),
                        setTestAdminUser: setTestJobSeeker,
                        apiBaseUrl: 'http://192.168.1.16:8000/api/v1',
                        getAuthHeaders: () => ({ 'Content-Type': 'application/json' }),
                        logout: logout
                    };
                }
                
                // Track page view
                if (typeof trackEvent === 'function') {
                    trackEvent('JobSeeker Applications Viewed', {
                        page_type: 'jobseeker_applications'
                    });
                }

                // Initialize applications page
                loadApplications();
            }, 500);
        });
    </script>
</body>
</html>